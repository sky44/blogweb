import{e as D,q as G,u as T}from"./user_api-d483d288.js";import{r as y,u as H,a as K,b as M,c as L,d as m,o as c,e as h,f as r,w as o,g as i,m as n,h as v,i as U,j as g,F as C,k as Q,l as N}from"./index-a4dd1763.js";function S(R){let l=R.split(".")[1];return JSON.parse(decodeURIComponent(escape(window.atob(l.replace(/-/g,"+").replace(/_/g,"/")))))}const W={class:"gvb_login_bg"},X={class:"gvb_login_container"},Y={class:"gvb_login_main"},Z=i("div",{class:"gvb_login_head"},"用户登录",-1),ee={class:"gvb_login_form"},ae={class:"gvb_login_form_item"},se=i("i",{class:"fa fa-user-o"},null,-1),re={class:"gvb_login_form_item"},te=i("i",{class:"fa fa-key"},null,-1),oe={class:"gvb_login_form_item"},ue={__name:"login",setup(R){const l=y(0),q=y(null);y(null);const I=H(),b=K(),x=M(),_=L({user_name:"",password:""}),k=y(!1),a=L({email:"",code:"",user_name:"",nick_name:"",password:"",re_password:""}),V=[{title:"请输入账户信息及邮箱"},{title:"请输入账户密码及验证码"}];function j(){l.value=0,k.value=0,a.email="",a.code="",a.user_name="",a.nick_name="",a.password="",a.re_password=""}let B=async(t,e)=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)?Promise.resolve():Promise.reject(),A=async(t,e)=>e===""?Promise.reject("Please input the password again"):e!==a.password?Promise.reject("Two inputs don't match!"):Promise.resolve();async function E(){try{await q.value.validate()}catch{return}let t=await T({email:a.email,nick_name:a.nick_name,user_name:a.user_name});if(t.code){n.error(t.msg);return}n.success(t.msg),l.value++}async function F(){if(a.password!==a.re_password){n.error("两次密码不一致！");return}let t=await T(a);if(t.code){n.error(t.msg);return}n.success(t.msg),l.value=0,k.value=!1}async function $(){if(_.user_name.trim()===""){n.error("请输入用户名");return}if(_.password.trim()===""){n.error("请输入密码");return}let t=await D(_);if(t.code){n.error(t.msg);return}n.success(t.msg);let e=S(t.data);e.token=t.data,x.serUserInfo(e);const u=I.query.redirect_url;if(u===void 0){setTimeout(()=>{b.push({name:"home"})},200);return}setTimeout(()=>{b.push({path:u})},200)}async function J(){const t=I.query;if(t.flag!=="qq")return;const e=t.code;let u=await G(e);if(u.code){n.error(u.msg);return}n.success(u.msg);let w=S(u.data);w.token=u.data,x.serUserInfo(w);let d=localStorage.getItem("redirect_url");d===null&&setTimeout(()=>{b.push({name:"home"})},200),setTimeout(()=>{b.push({path:d}),localStorage.removeItem("redirect_url")},200)}return J(),(t,e)=>{const u=m("a-step"),w=m("a-steps"),d=m("a-input"),p=m("a-form-item"),P=m("a-input-password"),O=m("a-form"),f=m("a-button"),z=m("a-modal");return c(),h("div",W,[r(z,{title:"用户注册",visible:k.value,"onUpdate:visible":e[7]||(e[7]=s=>k.value=s)},{footer:o(()=>[r(f,{onClick:j},{default:o(()=>[v("取消")]),_:1}),l.value===1?(c(),U(f,{key:0,type:"primary",onClick:e[6]||(e[6]=s=>l.value--)},{default:o(()=>[v("上一步")]),_:1})):g("",!0),l.value===0?(c(),U(f,{key:1,type:"primary",onClick:E},{default:o(()=>[v("下一步")]),_:1})):g("",!0),l.value===1?(c(),U(f,{key:2,type:"primary",onClick:F},{default:o(()=>[v("完成")]),_:1})):g("",!0)]),default:o(()=>[i("div",null,[r(w,{current:l.value},{default:o(()=>[(c(),h(C,null,Q(V,s=>r(u,{key:s.title,title:s.title},null,8,["title"])),64))]),_:1},8,["current"]),r(O,{model:a,name:"basic",ref_key:"formRef",ref:q,style:{"margin-top":"30px"},"label-col":{span:4},"wrapper-col":{span:18},autocomplete:"off"},{default:o(()=>[l.value===0?(c(),h(C,{key:0},[r(p,{label:"昵称",name:"nick_name","has-feedback":"",rules:[{required:!0,message:"请输入昵称"}]},{default:o(()=>[r(d,{value:a.nick_name,"onUpdate:value":e[0]||(e[0]=s=>a.nick_name=s),placeholder:"请输入昵称"},null,8,["value"])]),_:1}),r(p,{label:"用户名",name:"user_name","has-feedback":"",rules:[{required:!0,message:"请输入用户名"}]},{default:o(()=>[r(d,{value:a.user_name,"onUpdate:value":e[1]||(e[1]=s=>a.user_name=s),placeholder:"请输入用户名"},null,8,["value"])]),_:1}),r(p,{label:"邮箱地址",name:"email","has-feedback":"",rules:[{required:!0,message:"请输入邮箱"},{validator:N(B),message:"邮箱格式错误",trigger:"blur"}]},{default:o(()=>[r(d,{value:a.email,"onUpdate:value":e[2]||(e[2]=s=>a.email=s),placeholder:"请输入邮箱"},null,8,["value"])]),_:1},8,["rules"])],64)):g("",!0),l.value===1?(c(),h(C,{key:1},[r(p,{label:"密码",name:"password","has-feedback":"",rules:[{required:!0,message:"请输入密码",trigger:"blur"}]},{default:o(()=>[r(P,{value:a.password,"onUpdate:value":e[3]||(e[3]=s=>a.password=s),placeholder:"密码"},null,8,["value"])]),_:1}),r(p,{label:"确认密码",name:"re_password","has-feedback":"",rules:[{required:!0,message:"请再次确认密码"},{validator:N(A),message:"两次密码不一致",trigger:"blur"}]},{default:o(()=>[r(P,{value:a.re_password,"onUpdate:value":e[4]||(e[4]=s=>a.re_password=s),placeholder:"请再次输入密码"},null,8,["value"])]),_:1},8,["rules"]),r(p,{label:"验证码",name:"code","has-feedback":"",rules:[{required:!0,message:"请输入验证码"}]},{default:o(()=>[r(d,{value:a.code,"onUpdate:value":e[5]||(e[5]=s=>a.code=s),placeholder:"请输入验证码"},null,8,["value"])]),_:1})],64)):g("",!0)]),_:1},8,["model"])])]),_:1},8,["visible"]),i("div",X,[i("div",Y,[Z,i("div",ee,[i("div",ae,[r(d,{placeholder:"用户名",value:_.user_name,"onUpdate:value":e[8]||(e[8]=s=>_.user_name=s)},{prefix:o(()=>[se]),_:1},8,["value"])]),i("div",re,[r(d,{type:"password",placeholder:"密码",value:_.password,"onUpdate:value":e[9]||(e[9]=s=>_.password=s)},{prefix:o(()=>[te]),_:1},8,["value"])]),i("div",oe,[r(f,{type:"primary",onClick:$},{default:o(()=>[v("登录")]),_:1})])])])])])}}};export{ue as default};
