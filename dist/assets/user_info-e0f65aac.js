import{g as K,u as M,a as Q,s as W,b as X}from"./user_center_api-6722a616.js";import{c as B,a as Y,r as w,d as m,o as c,e as $,f as a,w as t,g as u,l as R,D as Z,m as v,h as _,i as E,j as k,F,k as ee,t as y}from"./index-a4ff3a35.js";import{l as ae}from"./logout-9bf6b406.js";import"./user_api-8939c76c.js";const q="/assets/ok-18e29ed7.gif",le="/assets/restart-73f90bf2.gif";const te={class:"gvb_user_info_bg"},se={class:"gvb_user_info_view"},re=u("div",{class:"user_head"}," 个人信息 ",-1),ne={class:"body user_info_view"},oe=["src"],ie=Z('<div class="user_head"> 每日奖励 </div><div class="body daily_reward"><div><img src="'+q+'" alt=""> 每日登陆 +2 </div><div><img src="'+q+'" alt=""> 发文 +3 </div><div><img src="'+q+'" alt=""> 发评论 +1 </div><div><img src="'+le+'" alt=""> 群聊 +0.5 </div></div><div class="user_head"> 成就勋章 </div><ul class="body medal"><li><img src="https://i0.hdslb.com/bfs/face/21fdd1bcd9ad1b52d5725026d71c185a68681644.png" alt=""><div class="name">初来乍到</div></li><li><img src="https://i0.hdslb.com/bfs/face/51ca16136e570938450bca360f28761ceb609f33.png" alt=""><div class="name">有爱萌新</div></li><li><img src="https://i0.hdslb.com/bfs/face/89491e6cee3b1c88292b618a58703ab614665f66.png" alt=""><div class="name">老司机</div></li></ul><div class="user_head"> 操作 </div>',5),ue={class:"body actions"},ce={__name:"user_info",setup(de){const r=B({addr:"",avatar:"",email:"",integral:0,link:"",nick_name:"",role:"",sign:"",sign_status:""}),b=B({avatar:"",link:"",nick_name:"",sign:""}),I=Y(),o=B({email:"",password:"",code:""}),S=[{title:"请输入邮箱"},{title:"请输入验证码"}],d=w(0),g=w(!1),U=w(!1),A=w(null),N=w(null),p=B({old_pwd:"",pwd:"",re_pwd:""});function D(){d.value=0,g.value=0,o.email="",o.password="",o.code=""}let h=async(s,e)=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.email)?Promise.resolve():Promise.reject(),O=async(s,e)=>p.re_pwd!==p.pwd?Promise.reject():Promise.resolve();async function T(){let s=await K();Object.assign(r,s.data),b.avatar=s.data.avatar,b.link=s.data.link,b.nick_name=s.data.nick_name,b.sign=s.data.sign}T();async function C(s){const e=r[s],P=b[s];if(e===P)return;const x={};x[s]=e;let i=await Q(x);if(i.code){v.error(i.msg);return}v.success(i.msg)}async function z(){try{await A.value.validate()}catch{return}let s=await W(o.email);if(s.code){v.error(s.msg);return}v.success(s.msg),d.value++}async function L(){let s=await X(o);if(s.code){v.error(s.msg);return}v.success(s.msg),d.value=0,g.value=!1}async function G(){try{await N.value.validate()}catch{return}let s=await M(p);if(s.code){v.error(s.msg);return}v.success(s.msg),U.value=!1,setTimeout(()=>{I.push({name:"login"})},500)}return(s,e)=>{const P=m("a-step"),x=m("a-steps"),i=m("a-input"),n=m("a-form-item"),V=m("a-form"),f=m("a-button"),j=m("a-modal"),H=m("a-textarea"),J=m("a-popconfirm");return c(),$("div",te,[a(j,{title:"绑定邮箱",visible:g.value,"onUpdate:visible":e[4]||(e[4]=l=>g.value=l)},{footer:t(()=>[a(f,{onClick:D},{default:t(()=>[_("取消")]),_:1}),d.value===1?(c(),E(f,{key:0,type:"primary",onClick:e[3]||(e[3]=l=>d.value--)},{default:t(()=>[_("上一步")]),_:1})):k("",!0),d.value===0?(c(),E(f,{key:1,type:"primary",onClick:z},{default:t(()=>[_("下一步")]),_:1})):k("",!0),d.value===1?(c(),E(f,{key:2,type:"primary",onClick:L},{default:t(()=>[_("完成")]),_:1})):k("",!0)]),default:t(()=>[u("div",null,[a(x,{current:d.value},{default:t(()=>[(c(),$(F,null,ee(S,l=>a(P,{key:l.title,title:l.title},null,8,["title"])),64))]),_:1},8,["current"]),a(V,{model:o,name:"basic",ref_key:"formRef",ref:A,style:{"margin-top":"30px"},"label-col":{span:4},"wrapper-col":{span:18},autocomplete:"off"},{default:t(()=>[d.value===0?(c(),E(n,{key:0,label:"邮箱地址",name:"email","has-feedback":"",rules:[{required:!0,message:"请输入邮箱"},{validator:R(h),message:"邮箱格式错误",trigger:"blur"}]},{default:t(()=>[a(i,{value:o.email,"onUpdate:value":e[0]||(e[0]=l=>o.email=l),placeholder:"请输入邮箱"},null,8,["value"])]),_:1},8,["rules"])):k("",!0),d.value===1?(c(),$(F,{key:1},[a(n,{label:"密码"},{default:t(()=>[a(i,{value:o.password,"onUpdate:value":e[1]||(e[1]=l=>o.password=l),placeholder:"请输入密码"},null,8,["value"])]),_:1}),a(n,{label:"验证码"},{default:t(()=>[a(i,{value:o.code,"onUpdate:value":e[2]||(e[2]=l=>o.code=l),placeholder:"请输入验证码"},null,8,["value"])]),_:1})],64)):k("",!0)]),_:1},8,["model"])])]),_:1},8,["visible"]),a(j,{title:"修改密码",visible:U.value,"onUpdate:visible":e[8]||(e[8]=l=>U.value=l),onOk:G},{default:t(()=>[a(V,{model:p,name:"basic",ref_key:"pwdFormRef",ref:N,"label-col":{span:4},"wrapper-col":{span:18},autocomplete:"off"},{default:t(()=>[a(n,{label:"原密码",name:"old_pwd","has-feedback":"",rules:[{required:!0,message:"请输入原密码"}]},{default:t(()=>[a(i,{value:p.old_pwd,"onUpdate:value":e[5]||(e[5]=l=>p.old_pwd=l),placeholder:"原密码"},null,8,["value"])]),_:1}),a(n,{label:"新密码",name:"pwd","has-feedback":"",rules:[{required:!0,message:"请输入新密码"}]},{default:t(()=>[a(i,{value:p.pwd,"onUpdate:value":e[6]||(e[6]=l=>p.pwd=l),placeholder:"新密码"},null,8,["value"])]),_:1}),a(n,{label:"确认密码",name:"re_pwd","has-feedback":"",rules:[{required:!0,message:"请输入确认密码"},{validator:R(O),message:"两次密码不一致",trigger:"blur"}]},{default:t(()=>[a(i,{value:p.re_pwd,"onUpdate:value":e[7]||(e[7]=l=>p.re_pwd=l),placeholder:"确认密码"},null,8,["value"])]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1},8,["visible"]),u("div",se,[re,u("div",ne,[a(V,{"label-col":{span:2},"wrapper-col":{span:22}},{default:t(()=>[a(n,{label:"昵称"},{default:t(()=>[a(i,{onBlur:e[9]||(e[9]=l=>C("nick_name")),label:"昵称",rules:[{required:!0,message:"请输入头像地址",trigger:"blur"}],placeholder:"昵称",value:r.nick_name,"onUpdate:value":e[10]||(e[10]=l=>r.nick_name=l),class:"user_ipt"},null,8,["value"])]),_:1}),a(n,{label:"头像"},{default:t(()=>[a(i,{onBlur:e[11]||(e[11]=l=>C("avatar")),placeholder:"头像",value:r.avatar,"onUpdate:value":e[12]||(e[12]=l=>r.avatar=l),class:"user_ipt"},null,8,["value"])]),_:1}),a(n,{label:"头像预览"},{default:t(()=>[u("img",{src:r.avatar,height:"60",style:{"border-radius":"5px"},alt:""},null,8,oe)]),_:1}),a(n,{label:"我的签名"},{default:t(()=>[a(H,{onBlur:e[13]||(e[13]=l=>C("sign")),placeholder:"我的签名",value:r.sign,"onUpdate:value":e[14]||(e[14]=l=>r.sign=l),class:"user_ipt","auto-size":{minRows:2,maxRows:5}},null,8,["value"])]),_:1}),a(n,{label:"我的博客"},{default:t(()=>[a(i,{onBlur:e[15]||(e[15]=l=>C("link")),placeholder:"我的博客",value:r.link,"onUpdate:value":e[16]||(e[16]=l=>r.link=l),class:"user_ipt"},null,8,["value"])]),_:1}),a(n,{label:"邮箱"},{default:t(()=>[u("span",null,y(r.email),1)]),_:1}),a(n,{label:"现地址"},{default:t(()=>[u("span",null,y(r.addr),1)]),_:1}),a(n,{label:"当前角色"},{default:t(()=>[u("span",null,y(r.role),1)]),_:1}),a(n,{label:"注册来源"},{default:t(()=>[u("span",null,y(r.sign_status),1)]),_:1}),a(n,{label:"我的积分"},{default:t(()=>[u("span",null,y(r.integral),1)]),_:1})]),_:1})]),ie,u("div",ue,[a(f,{type:"primary",onClick:e[17]||(e[17]=l=>g.value=!0)},{default:t(()=>[_("绑定邮箱")]),_:1}),a(f,{type:"primary",onClick:e[18]||(e[18]=l=>U.value=!0)},{default:t(()=>[_("修改密码")]),_:1}),a(J,{title:"确定要注销退出🐎?","ok-text":"确定","cancel-text":"取消",onConfirm:R(ae)},{default:t(()=>[a(f,{type:"danger"},{default:t(()=>[_("注销退出")]),_:1})]),_:1},8,["onConfirm"])])])])}}};export{ce as default};
