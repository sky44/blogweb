import{a as L}from"./date-d051bfca.js";import{S as R,c as C,d as c,o as d,e as b,g as f,f as u,n as p,w as r,M as v,N as w,m as _,i as k,h as S,j as m,t as O,l as G,F as M}from"./index-60e5bf44.js";function q(i,g){return R.get(i,{params:g,headers:{Gvb_referer:"admin"}})}function D(i,g){return R.delete(i,{data:{id_list:g}})}const H={class:"gvb_container"},I={class:"gvb_search"},J={class:"gvb_refresh"},Q=f("i",{class:"fa fa-refresh"},null,-1),W={class:"gvb_actions"},X={class:"gvb_tables"},Y={key:0},Z={class:"gvb_pages"},se={__name:"gvb_table",props:{columns:{type:Array},list:{type:Array},baseUrl:{type:String,default:""},isAdd:{type:Boolean,default:!0},isEdit:{type:Boolean,default:!0},isDelete:{type:Boolean,default:!0},isBatchDelete:{type:Boolean,default:!0},isSelect:{type:Boolean,default:!0},filters:{type:Array},pageSize:{type:Number,default:10},likeTitle:{type:String,default:"模糊搜索"},defaultDelete:{type:Boolean,default:!1}},emits:["delete"],setup(i,{expose:g,emit:B}){const o=i,s=C({page:1,limit:o.pageSize,key:""}),a=C({list:[],selectedRowKeys:[],count:0,spinning:!0});function K(e){a.selectedRowKeys=e}async function U(){if(o.defaultDelete){let e=await D(o.baseUrl,a.selectedRowKeys);if(e.code){_.error(e.msg);return}_.success(e.msg),l(s),a.selectedRowKeys=[];return}B("delete",a.selectedRowKeys),a.selectedRowKeys=[]}async function l(e){if(o.baseUrl===""){a.spinning=!1,a.list=o.list;return}a.spinning=!0;let t=await q(o.baseUrl,e);if(a.spinning=!1,t.data.list===void 0){a.list=t.data,a.count=t.data.length;return}a.list=t.data.list,a.count=t.data.count}function $(e,t){l(s)}async function z(e){if(o.defaultDelete){let t=await D(o.baseUrl,[e]);if(t.code){_.error(t.msg);return}_.success(t.msg),l(s);return}B("delete",[e])}function A(){_.success("刷新成功"),l(s)}function N(){s.key=s.key.trim(),s.page=1,l(s)}function E(e){e===void 0&&(e={}),s.page=1;let t={};Object.assign(t,s),Object.assign(t,e),l(t)}return l(s),g({ExportList:E}),(e,t)=>{const T=c("a-input-search"),h=c("a-button"),V=c("a-popconfirm"),j=c("a-table"),x=c("a-spin"),F=c("a-pagination");return d(),b("div",H,[f("div",I,[u(T,{placeholder:o.likeTitle,value:s.key,"onUpdate:value":t[0]||(t[0]=n=>s.key=n),style:{width:"200px"},onSearch:N},null,8,["placeholder","value"]),p(e.$slots,"filters"),f("div",J,[u(h,{title:"刷新本页",onClick:A},{default:r(()=>[Q]),_:1})])]),f("div",W,[p(e.$slots,"add"),p(e.$slots,"batchRemove",{},()=>[i.isDelete&&i.isBatchDelete&&a.selectedRowKeys.length?(d(),k(h,{key:0,type:"primary",danger:"",onClick:U},{default:r(()=>[S("批量删除")]),_:1})):m("",!0)])]),f("div",X,[u(x,{spinning:a.spinning,tip:"加载中...",delay:300},{default:r(()=>[u(j,{columns:o.columns,"row-selection":o.isSelect?{selectedRowKeys:a.selectedRowKeys,onChange:K}:void 0,pagination:!1,"row-key":"id","data-source":a.list},{bodyCell:r(({column:n,record:y,index:P})=>[p(e.$slots,"cell",v(w({column:n,record:y,index:P})),()=>[n.key==="created_at"?(d(),b("span",Y,O(G(L)(y.created_at)),1)):m("",!0),n.key==="action"?(d(),b(M,{key:1},[p(e.$slots,"edit",v(w({column:n,record:y})),()=>[i.isEdit?(d(),k(h,{key:0,type:"primary"},{default:r(()=>[S("编辑")]),_:1})):m("",!0)]),p(e.$slots,"delete",v(w({column:n,record:y})),()=>[o.isDelete?(d(),k(V,{key:0,title:"是否确定删除?","ok-text":"删除","cancel-text":"取消",onConfirm:ee=>z(y.id)},{default:r(()=>[u(h,{class:"gvb_table_action delete",type:"primary",danger:""},{default:r(()=>[S("删除")]),_:1})]),_:2},1032,["onConfirm"])):m("",!0)])],64)):m("",!0)])]),_:3},8,["columns","row-selection","data-source"])]),_:3},8,["spinning"])]),f("div",Z,[u(F,{showSizeChanger:!1,current:s.page,"onUpdate:current":t[1]||(t[1]=n=>s.page=n),"page-size":s.limit,"onUpdate:pageSize":t[2]||(t[2]=n=>s.limit=n),onChange:$,total:a.count,"show-total":n=>`共 ${n} 条`},null,8,["current","page-size","total","show-total"])])])}}};export{se as _};
