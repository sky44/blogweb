import{b as z,c as b,r as x,d as p,o as i,e as o,f as c,w as l,v as N,z as R,g as t,F as y,k as V,p as $,t as m,j as w,h as j,m as k}from"./index-a4ff3a35.js";import{_ as B}from"./gvb_table-a7f3b8bc.js";import{c as K,m as T}from"./user_center_api-6722a616.js";import"./date-d051bfca.js";const A={class:"gvb_chat_body"},F={class:"avatar"},L=["src"],S={class:"message-main"},U={class:"message-user"},D={class:"message-content"},E={class:"content"},q={class:"txt-message"},G=["src"],H={style:{"margin-left":"1rem"}},J=["src"],O={style:{"margin-left":"1rem"}},Z={__name:"user_messages",setup(P){const d=z(),v=b({list:[{send_user_id:2,send_user_nick_name:"zhangsan",send_user_avatar:"/uploads/avatar/default.jpg",rev_user_id:1,rev_user_nick_name:"admin",rev_user_avatar:"/uploads/avatar/default.jpg",content:"test1111",created_at:"2023-06-01T23:26:35.899+08:00",message_count:1}],columns:[{title:"发送人",dataIndex:"send_user",key:"send_user"},{title:"接收人",dataIndex:"rev_user",key:"rev_user"},{title:"消息总数",dataIndex:"message_count",key:"message_count"},{title:"最新消息内容",dataIndex:"content",key:"content"},{title:"最新消息时间",dataIndex:"created_at",key:"created_at"},{title:"操作",dataIndex:"action",key:"action"}],record_list:[]}),n=b({content:"",rev_user_id:null,send_user_id:d.userInfo.user_id}),f=x(!1),g=x("");async function I(e){let a=null;e.send_user_id===d.userInfo.user_id&&(g.value=`与${e.rev_user_nick_name}的聊天`,a=e.rev_user_id),e.rev_user_id===d.userInfo.user_id&&(g.value=`与${e.send_user_nick_name}的聊天`,a=e.send_user_id),f.value=!0,n.rev_user_id=a,await h(a)}async function h(e){let a=await K(e),u=[];for(const _ of a.data)_.send_user_id===d.userInfo.user_id&&(_.is_me=!0),u.push(_);v.record_list=u}async function C(){if(n.content.trim()===""){k.error("请输入聊天内容");return}let e=await T(n);if(e.code){k.error(e.msg);return}k.success(e.msg),await h(n.rev_user_id),n.content=""}return(e,a)=>{const u=p("a-textarea"),_=p("a-modal"),M=p("a-button");return i(),o("div",null,[c(_,{title:g.value,visible:f.value,"onUpdate:visible":a[1]||(a[1]=s=>f.value=s),class:"gvb_chat_modal",width:"40%"},{footer:l(()=>[c(u,{value:n.content,"onUpdate:value":a[0]||(a[0]=s=>n.content=s),placeholder:"开始你们的聊天（ctrl+enter 发送消息）","auto-size":{minRows:4,maxRows:6},onKeydown:N(R(C,["ctrl"]),["enter"])},null,8,["value","onKeydown"])]),default:l(()=>[t("div",A,[(i(!0),o(y,null,V(v.record_list,(s,r)=>(i(),o("div",{class:"message",key:r},[t("div",{class:$({me:s.is_me})},[t("div",F,[t("img",{src:s.send_user_avatar,alt:""},null,8,L)]),t("div",S,[t("div",U,m(s.send_user_nick_name),1),t("div",D,[t("div",E,[t("div",q,m(s.content),1)])])])],2)]))),128))])]),_:1},8,["title","visible"]),c(B,{columns:v.columns,"base-url":"/api/messages","like-title":"搜索",ref:"gvbTable","is-edit":!1,"is-add":!1,"is-delete":!1,"is-select":!1,"default-delete":""},{cell:l(({column:s,record:r})=>[s.key==="send_user"?(i(),o(y,{key:0},[t("img",{src:r.send_user_avatar,height:"40",style:{"border-radius":"50%"},alt:""},null,8,G),t("span",H,m(r.send_user_nick_name),1)],64)):w("",!0),s.key==="rev_user"?(i(),o(y,{key:1},[t("img",{src:r.rev_user_avatar,height:"40",style:{"border-radius":"50%"},alt:""},null,8,J),t("span",O,m(r.rev_user_nick_name),1)],64)):w("",!0)]),edit:l(({record:s})=>[c(M,{type:"primary",onClick:r=>I(s)},{default:l(()=>[j(" 回复")]),_:2},1032,["onClick"])]),_:1},8,["columns"])])}}};export{Z as default};
