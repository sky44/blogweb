import{b as U,u as j,c as E,d as A,o as n,e as l,F as N,k as H,g as t,t as o,l as d,f as u,w as D,j as I,v as O,z as W,h as T,m as c,r as F,a as J,s as Q,q as X,i as L,y as Y,p as M}from"./index-a4dd1763.js";import{_ as Z}from"./gvb_footer.vue_vue_type_style_index_0_lang-d26c32f3.js";import{_ as tt}from"./gvb_banner-0e6cd9ff.js";import{_ as et}from"./gvb_footer-0f6a70df.js";import{a as P,g as st}from"./date-d051bfca.js";import{R as ot,I as nt}from"./style-8efb08d7.js";import{a as ct,b as it,c as at}from"./article_api-4091d731.js";import{g as lt,c as G,a as rt}from"./comment_api-2d620a14.js";import"./gvb_user_info-29868ed3.js";import"./logout-5bcf33d9.js";import"./user_api-d483d288.js";/* empty css                                                   */const _t={class:"gvb_article_comment_list"},dt={class:"avatar"},ut=["src"],mt={class:"comment"},pt={class:"name"},ht={class:"comment_content"},vt={class:"info"},ft={class:"date"},gt=["onClick"],yt={key:0,class:"delete"},kt={class:"sub_comment_list"},bt={class:"sub_avatar"},wt=["src"],xt={class:"sub_comment"},$t={class:"line"},Ct={class:"name"},Tt={class:"content"},It={class:"info"},At={class:"date"},Et=["onClick"],Dt={key:1,class:"sub_comment_apply"},St=["src"],zt={__name:"gvb_article_comment_list",setup(q,{expose:b}){const v=U(),S=j().params.id,f=E({list:[{article_id:"",comment_count:0,comment_model:"",content:"",created_at:"",digg_count:0,id:0,parent_comment_id:0,sub_comments:[],user:{addr:"",avatar:"",created_at:"",email:"",id:0,integral:0,ip:"",link:"",nick_name:"",role:1,sign:"",sign_status:1,tel:"",token:"",user_name:""},user_id:0}]}),r=E({article_id:S,content:"",parent_comment_id:null,nick_name:""}),k=v.userInfo.role,x=v.userInfo.user_id;async function e(){let _=await lt(S);f.list=_.data,console.log(f.list)}function R(_,m){if(v.userInfo.role===0){c.warn("请登陆后回复");return}r.content="",r.parent_comment_id=_,r.nick_name=m}async function g(){if(r.content.trim()===""){c.warn("评论内容不可为空");return}let _=await G(r);if(_.code){c.error(_.msg);return}c.success(_.msg),r.content="",e()}async function $(_){let m=await rt(_);if(m.code){c.error(m.msg);return}c.success(m.msg),e()}return b({getData:e}),e(),(_,m)=>{const z=A("a-popconfirm"),B=A("a-input"),K=A("a-button");return n(),l("div",_t,[(n(!0),l(N,null,H(f.list,i=>(n(),l("div",{class:"gvb_comment_item",key:i.id},[t("div",dt,[t("img",{src:i.user.avatar,alt:""},null,8,ut)]),t("div",mt,[t("div",pt,o(i.user.nick_name),1),t("div",ht,o(i.content),1),t("div",vt,[t("span",ft,o(d(P)(i.created_at)),1),t("span",{class:"apply",onClick:a=>R(i.id,i.user.nick_name)},"回复 ("+o(i.comment_count)+")",9,gt),u(z,{title:"确定删除这条评论吗","ok-text":"删除","cancel-text":"取消",onConfirm:a=>$(i.id)},{default:D(()=>[d(k)===1||d(x)===i.user_id?(n(),l("span",yt,"删除")):I("",!0)]),_:2},1032,["onConfirm"])]),t("div",kt,[i.sub_comments.length?(n(!0),l(N,{key:0},H(i.sub_comments,a=>(n(),l("div",{class:"sub_comment_item",key:a.id},[t("div",bt,[t("img",{src:a.user.avatar,alt:""},null,8,wt)]),t("div",xt,[t("div",$t,[t("span",Ct,o(a.user.nick_name),1),t("span",Tt,o(a.content),1)]),t("div",It,[t("span",At,o(d(P)(a.created_at)),1),u(z,{title:"确定删除这条评论吗","ok-text":"删除","cancel-text":"取消",onConfirm:s=>$(a.id)},{default:D(()=>[d(k)===1||d(x)===a.user_id?(n(),l("span",{key:0,class:"delete",onClick:s=>$(a.id)},"删除",8,Et)):I("",!0)]),_:2},1032,["onConfirm"])])])]))),128)):I("",!0),r.parent_comment_id===i.id?(n(),l("div",Dt,[t("img",{src:d(v).userInfo.avatar,alt:"",class:"user_avatar"},null,8,St),u(B,{class:"comment_ipt",onKeydown:O(W(g,["ctrl"]),["enter"]),value:r.content,"onUpdate:value":m[0]||(m[0]=a=>r.content=a),placeholder:"回复 @ "+r.nick_name},null,8,["onKeydown","value","placeholder"]),u(K,{type:"primary",onClick:g},{default:D(()=>[T("回复")]),_:1})])):I("",!0)])])]))),128))])}}};function Vt(q){let b=null;b=setInterval(()=>{if(document.documentElement.scrollTop>=q){clearInterval(b);return}document.documentElement.scrollTop+=20},5)}const qt={class:"base_view article_view"},Rt={style:{height:"600px"}},Bt={class:"gvb_base_container"},Kt={class:"gvb_inner_container"},Ft=t("div",{class:"go_top_box",style:{position:"absolute",top:"640px"}},null,-1),Nt={class:"article_head"},Ht={class:"info"},Lt={class:"date"},Mt={class:"tag"},Pt=t("i",{title:"文章标签",class:"fa fa-tags"},null,-1),Ut={class:"article_content"},jt=t("div",{class:"article_on_the"},[t("div",{class:"article_on_the_inner"},[t("a",{href:"#"},"上一篇"),t("a",{href:"#"},"下一篇")])],-1),Ot={class:"article_comment_to"},Wt=t("div",{class:"title"},"分享您的伟论",-1),Gt={class:"body"},Jt={class:"comment_footer"},Qt={class:"article_user_info"},Xt={class:"user_info_avatar"},Yt=["src"],Zt={class:"user_info_info"},te={class:"user_name"},ee=t("div",{class:"user_abstract"}," 艰苦朴素的打工仔 ",-1),se=t("div",{class:"user_link"},[t("a",{href:"#"},[t("i",{class:"fa fa-github-square"})])],-1),oe={class:"article_data"},ne={class:"item"},ce=t("span",null,"浏览",-1),ie={class:"item"},ae=t("span",null,"收藏",-1),le={class:"item"},re=t("span",null,"点赞",-1),_e={class:"item"},de=t("span",null,"评论",-1),ue={class:"article_directory"},me=t("div",{class:"title"}," 文章目录 ",-1),pe={class:"body"},he={class:"article_action"},ve={class:"gvb_icon","aria-hidden":"true",style:{"font-size":"22px"}},fe=t("use",{"xlink:href":"#icon-dianzan"},null,-1),ge=[fe],ye={class:"gvb_icon","aria-hidden":"true",style:{"font-size":"22px"}},ke=t("use",{"xlink:href":"#icon-shoucang"},null,-1),be=[ke],we={class:"gvb_icon","aria-hidden":"true",style:{"font-size":"22px",color:"#76bdbd"}},xe=t("use",{"xlink:href":"#icon-huidaodingbu"},null,-1),$e=[xe],Ce={class:"gvb_icon","aria-hidden":"true",style:{"font-size":"22px"}},Te=t("use",{"xlink:href":"#icon-icon_pinglun"},null,-1),Ie=[Te],He={__name:"article",setup(q){const b=document.documentElement,v=F(null),w=j(),S=J(),f=U(),r=F(),k=E({position:"inherit",width:"auto",top:"60px"}),x=F("dark");Q(()=>f.theme,s=>{x.value=s?"":"dark"},{immediate:!0});const e=E({abstract:"",banner_id:0,banner_url:"",category:"",collects_count:0,comment_count:0,content:"",created_at:"",digg_count:0,id:"",keyword:"",link:"",look_count:0,source:"",tags:[],title:"",updated_at:"",user_avatar:"",user_id:0,user_nick_name:"",is_collect:!1,is_digg:!1});function R(){S.push({name:"edit_article",params:{id:w.params.id},query:{redirect_url:"/article/"+w.params.id}})}const g=E({article_id:w.params.id,content:"",parent_comment_id:null});async function $(){if(f.userInfo.role===0){c.warn("请登陆后发布评论");return}if(g.content.trim()===""){c.warn("评论内容不可为空");return}let s=await G(g);if(s.code){c.error(s.msg);return}c.success(s.msg),g.content=""}async function _(){let s=await ct(w.params.id);if(s.code){c.error(s.msg);return}Object.assign(e,s.data)}function m(){(document.scrollingElement.scrollTop||document.body.scrollTop)>=r.value?k.position="fixed":k.position="inherit"}async function z(){let s=await it(e.id);if(s.code){c.error(s.msg);return}c.success(s.msg),e.is_digg=!0,e.digg_count++,setTimeout(()=>{e.is_digg=!1},1e3)}async function B(){if(f.userInfo.role===0){c.warn("请登陆后收藏文章");return}let s=await at(e.id);if(s.code){c.error(s.msg);return}c.success(s.msg),e.is_collect=!e.is_collect}X(()=>{r.value=v.value.offsetTop-38,k.width=v.value.scrollWidth+"px";let s=document.querySelector(".md-editor-preview");window.addEventListener("scroll",m),setTimeout(()=>{s.scrollHeight;let h=document.documentElement.offsetHeight-500;document.querySelector(".article_directory .body").style.maxHeight=h+"px"},100);let p=w.hash;p!==""&&setTimeout(()=>{let h=document.querySelector(p).getBoundingRect().top;Vt(h-80)},100)});function K(){a(".article_comment_ipt"),setTimeout(()=>{document.querySelector(".article_comment_ipt").focus()},800)}function i(){a(".go_top_box")}function a(s){const p=document.querySelector(s),C=p.offsetTop;if(typeof window.getComputedStyle(document.body).scrollBehavior>"u"){let h=document.documentElement.scrollTop||document.body.scrollTop;const V=function(){let y=C-h;h=h+y/5,Math.abs(y)<1?window.scrollTo(0,C):(window.scrollTo(0,h),setTimeout(V,20))};V()}else p.scrollIntoView({behavior:"smooth",inline:"nearest"})}return _(),(s,p)=>{const C=A("a-tag"),h=A("a-textarea"),V=A("a-button");return n(),l("div",qt,[u(Z),t("div",Rt,[e.title!==""?(n(),L(tt,{key:0,class:"gvb_article_title",url:e.banner_url,slogan:e.title,abstract:e.abstract,"is-article":""},null,8,["url","slogan","abstract"])):I("",!0)]),t("div",Bt,[t("div",Kt,[Ft,t("article",null,[t("div",Nt,[t("h2",null,[T(o(e.title)+" ",1),d(f).userInfo.role===1?(n(),l("i",{key:0,class:"fa fa-edit",onClick:R})):I("",!0)]),t("div",Ht,[t("span",Lt,"发布时间："+o(d(st)(e.created_at)),1),t("span",null,"作者："+o(e.user_nick_name),1)]),t("div",Mt,[Pt,(n(!0),l(N,null,H(e.tags,y=>(n(),L(C,{color:"red"},{default:D(()=>[T(o(y),1)]),_:2},1024))),256))])]),t("div",Ut,[u(d(ot),{previewOnly:!0,modelValue:e.content,"onUpdate:modelValue":p[0]||(p[0]=y=>e.content=y),theme:x.value,editorId:e.id},null,8,["modelValue","theme","editorId"])]),jt,t("div",Ot,[Wt,t("div",Gt,[u(h,{class:"article_comment_ipt",value:g.content,"onUpdate:value":p[1]||(p[1]=y=>g.content=y),"auto-size":{minRows:6,maxRows:6},onKeydown:O(W($,["ctrl"]),["enter"]),placeholder:"请输入文章评论"},null,8,["value","onKeydown"]),u(V,{class:"add_comment_btn",onClick:$,type:"primary"},{default:D(()=>[T("发布")]),_:1})]),t("div",Jt,[t("span",null,o(e.look_count),1),T(" 次浏览， "),t("span",null,o(e.comment_count),1),T(" 条评论 ")])]),u(zt,{style:{"margin-top":"20px"}})]),t("aside",null,[t("div",Qt,[t("div",Xt,[t("img",{src:e.user_avatar,alt:""},null,8,Yt)]),t("div",Zt,[t("div",te,o(e.user_nick_name),1),ee]),se,t("div",oe,[t("div",ne,[t("span",null,o(e.look_count),1),ce]),t("div",ie,[t("span",null,o(e.collects_count),1),ae]),t("div",le,[t("span",null,o(e.digg_count),1),re]),t("div",_e,[t("span",null,o(e.comment_count),1),de])])]),t("div",{class:"article_directory_action",ref_key:"article_directory",ref:v,style:Y(k)},[t("div",ue,[me,t("div",pe,[u(d(nt),{ref:"articlePreview",editorId:e.id,"scroll-element":d(b),theme:x.value,"scroll-element-offset-top":80,offsetTop:100},null,8,["editorId","scroll-element","theme"])])]),t("div",he,[t("div",{class:M({item:!0,active:e.is_digg}),onClick:z},[(n(),l("svg",ve,ge))],2),t("div",{class:M({item:!0,active:!e.is_collect}),onClick:B},[(n(),l("svg",ye,be))],2),t("div",{class:"item",onClick:i},[(n(),l("svg",we,$e))]),t("div",{class:"item",onClick:K},[(n(),l("svg",Ce,Ie))])])],4)])])]),u(et)])}}};export{He as default};
