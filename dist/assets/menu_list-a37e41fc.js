import{_ as z}from"./gvb_table-e975e912.js";import{i as S}from"./image_api-c8b8668a.js";import{r as v,c as U,d as i,o as u,e as d,f as n,w as s,K as G,L as H,m as L,g as k,F as y,k as h,i as J,t as N,h as R,j as B}from"./index-a4dd1763.js";import"./date-d051bfca.js";const P=["src"],Q=["src"],W={key:1,style:{display:"grid","grid-template-columns":"repeat(3, 1fr)","grid-column-gap":"5px","grid-row-gap":"5px"}},X=["src"],ne={__name:"menu_list",setup(Y){const m=v(""),p=v([]),D={abstract_time:7,banner_time:7,path:"",slogan:"",sort:0,title:"",abstract:[],image_sort_list:[]},a=U({abstract_time:7,banner_time:7,path:"",slogan:"",sort:0,title:"",abstract:[],image_sort_list:[]}),x=v(null);async function M(){let l=await S();r.imageNameList=l.data}function V(l){return l[0].props.src}async function j(){try{x.value.validate()}catch{return}a.abstract=m.value.split(`
`);let l;if(b.value?l=await G(b.value,a):l=await H(a),l.code){L.error(l.msg);return}m.value="",p.value=[],r.visible=!1,L.success(l.msg),I.value.ExportList()}function A(l){a.image_sort_list=[];for(let e=0;e<l.length;e++)a.image_sort_list.push({image_id:l[e],sort:e})}M();const I=v(null),b=v(0),r=U({columns:[{title:"id",dataIndex:"id",key:"id"},{title:"菜单标题",dataIndex:"title",key:"title"},{title:"路径",dataIndex:"path",key:"path"},{title:"slogan",dataIndex:"slogan",key:"slogan"},{title:"介绍",dataIndex:"abstract",key:"abstract"},{title:"介绍切换时间",dataIndex:"abstract_time",key:"abstract_time"},{title:"banner切换时间",dataIndex:"banner_time",key:"banner_time"},{title:"排序",dataIndex:"sort",key:"sort"},{title:"banner",dataIndex:"banners",key:"banners"},{title:"发布时间",dataIndex:"created_at",key:"created_at"},{title:"操作",dataIndex:"action",key:"action"}],visible:!1,imageNameList:[]});function O(){b.value=0,r.visible=!0,Object.assign(a,D)}function T(l){b.value=l.id,a.abstract_time=l.abstract_time,a.banner_time=l.banner_time,a.path=l.path,a.slogan=l.slogan,a.sort=l.sort,a.title=l.title,a.abstract=l.abstract,m.value=l.abstract.join(`
`),p.value=[],a.image_sort_list=[];for(let e=0;e<l.banners.length;e++)p.value.push(l.banners[e].id),a.image_sort_list.push({image_id:l.banners[e].id,sort:e});r.visible=!0}return(l,e)=>{const g=i("a-input"),o=i("a-form-item"),q=i("a-textarea"),f=i("a-input-number"),E=i("a-select-option"),F=i("a-select"),K=i("a-form"),$=i("a-modal"),w=i("a-button");return u(),d("div",null,[n($,{title:b.value?"编辑菜单":"添加菜单",visible:r.visible,"onUpdate:visible":e[8]||(e[8]=t=>r.visible=t),onOk:j},{default:s(()=>[n(K,{model:a,name:"basic",ref_key:"formRef",ref:x,"label-col":{span:4},"wrapper-col":{span:20},autocomplete:"off"},{default:s(()=>[n(o,{label:"菜单名称",name:"title","has-feedback":"",rules:[{required:!0,message:"请输入菜单名称",trigger:"blur"}]},{default:s(()=>[n(g,{value:a.title,"onUpdate:value":e[0]||(e[0]=t=>a.title=t),placeholder:"菜单名称"},null,8,["value"])]),_:1}),n(o,{label:"菜单路径",name:"path","has-feedback":"",rules:[{required:!0,message:"请输入菜单路径",trigger:"blur"}]},{default:s(()=>[n(g,{value:a.path,"onUpdate:value":e[1]||(e[1]=t=>a.path=t),placeholder:"菜单路径"},null,8,["value"])]),_:1}),n(o,{label:"slogan",name:"slogan","has-feedback":""},{default:s(()=>[n(g,{value:a.slogan,"onUpdate:value":e[2]||(e[2]=t=>a.slogan=t),placeholder:"slogan"},null,8,["value"])]),_:1}),n(o,{label:"菜单简介",name:"abstract","has-feedback":""},{default:s(()=>[n(q,{value:m.value,"onUpdate:value":e[3]||(e[3]=t=>m.value=t),placeholder:"菜单简介,多个简介用换行分隔","auto-size":{minRows:2,maxRows:5}},null,8,["value"])]),_:1}),n(o,{label:"banner时间",name:"banner_time","has-feedback":""},{default:s(()=>[n(f,{value:a.banner_time,"onUpdate:value":e[4]||(e[4]=t=>a.banner_time=t),placeholder:"banner时间"},null,8,["value"])]),_:1}),n(o,{label:"简介时间",name:"abstract_time","has-feedback":""},{default:s(()=>[n(f,{value:a.abstract_time,"onUpdate:value":e[5]||(e[5]=t=>a.abstract_time=t),placeholder:"简介时间"},null,8,["value"])]),_:1}),n(o,{label:"序号",name:"sort","has-feedback":""},{default:s(()=>[n(f,{value:a.sort,"onUpdate:value":e[6]||(e[6]=t=>a.sort=t),placeholder:"序号"},null,8,["value"])]),_:1}),n(o,{label:"banner选择"},{default:s(()=>[n(F,{ref:"select",value:p.value,"onUpdate:value":e[7]||(e[7]=t=>p.value=t),placeholder:"选择banner",mode:"multiple",onChange:A},{tagRender:s(({value:t,label:_,closable:c,onClose:C,option:Z})=>[k("img",{src:V(_),height:"30",style:{"border-radius":"5px","margin-right":"5px"}},null,8,Q)]),default:s(()=>[(u(!0),d(y,null,h(r.imageNameList,t=>(u(),J(E,{value:t.id,key:t.id},{default:s(()=>[k("img",{src:t.path,alt:"",height:"30",style:{"border-radius":"5px","margin-right":"10px"}},null,8,P),k("span",null,N(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","visible"]),n(z,{columns:r.columns,"base-url":"/api/menus","like-title":"搜索菜单名称",ref_key:"gvbTable",ref:I,"default-delete":""},{add:s(()=>[n(w,{type:"primary",onClick:O},{default:s(()=>[R("添加")]),_:1})]),edit:s(({record:t})=>[n(w,{type:"primary",onClick:_=>T(t)},{default:s(()=>[R("编辑")]),_:2},1032,["onClick"])]),cell:s(({column:t,record:_})=>[t.key==="abstract"?(u(!0),d(y,{key:0},h(_.abstract,(c,C)=>(u(),d("div",{key:C},N(c),1))),128)):B("",!0),t.key==="banners"?(u(),d("div",W,[(u(!0),d(y,null,h(_.banners,c=>(u(),d("img",{key:c.id,src:c.path,height:"40",style:{"border-radius":"5px"}},null,8,X))),128))])):B("",!0)]),_:1},8,["columns"])])}}};export{ne as default};
