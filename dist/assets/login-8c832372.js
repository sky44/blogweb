import{e as D,g as G,q as H,u as P}from"./user_api-595c9794.js";import{r as y,u as K,a as M,b as W,c as T,d as _,o as c,e as h,f as r,w as o,g as l,m as u,h as v,i as C,j as b,F as U,k as X,l as N}from"./index-60e5bf44.js";const Y="/assets/qq_logo-af73c917.png";function S(R){let n=R.split(".")[1];return JSON.parse(decodeURIComponent(escape(window.atob(n.replace(/-/g,"+").replace(/_/g,"/")))))}const Z={class:"gvb_login_bg"},ee={class:"gvb_login_container"},se={class:"gvb_login_main"},ae=l("div",{class:"gvb_login_head"},"用户登录",-1),te={class:"gvb_login_form"},re={class:"gvb_login_form_item"},oe=l("i",{class:"fa fa-user-o"},null,-1),le={class:"gvb_login_form_item"},ne=l("i",{class:"fa fa-key"},null,-1),ue={class:"gvb_login_form_item"},ie={class:"gvb_login_form_item"},de=l("div",{class:"gvb_login_other"},"第三方登录",-1),ce={__name:"login",setup(R){const n=y(0),q=y(null);y(null);const x=K(),k=M(),I=W(),m=T({user_name:"",password:""}),g=y(!1),s=T({email:"",code:"",user_name:"",nick_name:"",password:"",re_password:""}),V=[{title:"请输入账户信息及邮箱"},{title:"请输入账户密码及验证码"}];function j(){n.value=0,g.value=0,s.email="",s.code="",s.user_name="",s.nick_name="",s.password="",s.re_password=""}let A=async(a,e)=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)?Promise.resolve():Promise.reject(),B=async(a,e)=>e===""?Promise.reject("Please input the password again"):e!==s.password?Promise.reject("Two inputs don't match!"):Promise.resolve();async function Q(){try{await q.value.validate()}catch{return}let a=await P({email:s.email,nick_name:s.nick_name,user_name:s.user_name});if(a.code){u.error(a.msg);return}u.success(a.msg),n.value++}async function E(){if(s.password!==s.re_password){u.error("两次密码不一致！");return}let a=await P(s);if(a.code){u.error(a.msg);return}u.success(a.msg),n.value=0,g.value=!1}async function $(){if(m.user_name.trim()===""){u.error("请输入用户名");return}if(m.password.trim()===""){u.error("请输入密码");return}let a=await D(m);if(a.code){u.error(a.msg);return}u.success(a.msg);let e=S(a.data);e.token=a.data,I.serUserInfo(e);const i=x.query.redirect_url;if(i===void 0){setTimeout(()=>{k.push({name:"home"})},200);return}setTimeout(()=>{k.push({path:i})},200)}async function F(){let a=await G();if(a.code){u.error(a.msg);return}location.href=a.data}async function J(){const a=x.query;if(a.flag!=="qq")return;const e=a.code;let i=await H(e);if(i.code){u.error(i.msg);return}u.success(i.msg);let w=S(i.data);w.token=i.data,I.serUserInfo(w);let d=localStorage.getItem("redirect_url");d===null&&setTimeout(()=>{k.push({name:"home"})},200),setTimeout(()=>{k.push({path:d}),localStorage.removeItem("redirect_url")},200)}return J(),(a,e)=>{const i=_("a-step"),w=_("a-steps"),d=_("a-input"),p=_("a-form-item"),L=_("a-input-password"),O=_("a-form"),f=_("a-button"),z=_("a-modal");return c(),h("div",Z,[r(z,{title:"用户注册",visible:g.value,"onUpdate:visible":e[7]||(e[7]=t=>g.value=t)},{footer:o(()=>[r(f,{onClick:j},{default:o(()=>[v("取消")]),_:1}),n.value===1?(c(),C(f,{key:0,type:"primary",onClick:e[6]||(e[6]=t=>n.value--)},{default:o(()=>[v("上一步")]),_:1})):b("",!0),n.value===0?(c(),C(f,{key:1,type:"primary",onClick:Q},{default:o(()=>[v("下一步")]),_:1})):b("",!0),n.value===1?(c(),C(f,{key:2,type:"primary",onClick:E},{default:o(()=>[v("完成")]),_:1})):b("",!0)]),default:o(()=>[l("div",null,[r(w,{current:n.value},{default:o(()=>[(c(),h(U,null,X(V,t=>r(i,{key:t.title,title:t.title},null,8,["title"])),64))]),_:1},8,["current"]),r(O,{model:s,name:"basic",ref_key:"formRef",ref:q,style:{"margin-top":"30px"},"label-col":{span:4},"wrapper-col":{span:18},autocomplete:"off"},{default:o(()=>[n.value===0?(c(),h(U,{key:0},[r(p,{label:"昵称",name:"nick_name","has-feedback":"",rules:[{required:!0,message:"请输入昵称"}]},{default:o(()=>[r(d,{value:s.nick_name,"onUpdate:value":e[0]||(e[0]=t=>s.nick_name=t),placeholder:"请输入昵称"},null,8,["value"])]),_:1}),r(p,{label:"用户名",name:"user_name","has-feedback":"",rules:[{required:!0,message:"请输入用户名"}]},{default:o(()=>[r(d,{value:s.user_name,"onUpdate:value":e[1]||(e[1]=t=>s.user_name=t),placeholder:"请输入用户名"},null,8,["value"])]),_:1}),r(p,{label:"邮箱地址",name:"email","has-feedback":"",rules:[{required:!0,message:"请输入邮箱"},{validator:N(A),message:"邮箱格式错误",trigger:"blur"}]},{default:o(()=>[r(d,{value:s.email,"onUpdate:value":e[2]||(e[2]=t=>s.email=t),placeholder:"请输入邮箱"},null,8,["value"])]),_:1},8,["rules"])],64)):b("",!0),n.value===1?(c(),h(U,{key:1},[r(p,{label:"密码",name:"password","has-feedback":"",rules:[{required:!0,message:"请输入密码",trigger:"blur"}]},{default:o(()=>[r(L,{value:s.password,"onUpdate:value":e[3]||(e[3]=t=>s.password=t),placeholder:"密码"},null,8,["value"])]),_:1}),r(p,{label:"确认密码",name:"re_password","has-feedback":"",rules:[{required:!0,message:"请再次确认密码"},{validator:N(B),message:"两次密码不一致",trigger:"blur"}]},{default:o(()=>[r(L,{value:s.re_password,"onUpdate:value":e[4]||(e[4]=t=>s.re_password=t),placeholder:"请再次输入密码"},null,8,["value"])]),_:1},8,["rules"]),r(p,{label:"验证码",name:"code","has-feedback":"",rules:[{required:!0,message:"请输入验证码"}]},{default:o(()=>[r(d,{value:s.code,"onUpdate:value":e[5]||(e[5]=t=>s.code=t),placeholder:"请输入验证码"},null,8,["value"])]),_:1})],64)):b("",!0)]),_:1},8,["model"])])]),_:1},8,["visible"]),l("div",ee,[l("div",se,[ae,l("div",te,[l("div",re,[r(d,{placeholder:"用户名",value:m.user_name,"onUpdate:value":e[8]||(e[8]=t=>m.user_name=t)},{prefix:o(()=>[oe]),_:1},8,["value"])]),l("div",le,[r(d,{type:"password",placeholder:"密码",value:m.password,"onUpdate:value":e[9]||(e[9]=t=>m.password=t)},{prefix:o(()=>[ne]),_:1},8,["value"])]),l("div",ue,[r(f,{type:"primary",onClick:$},{default:o(()=>[v("登录")]),_:1})]),l("div",ie,[r(f,{type:"link",onClick:e[10]||(e[10]=t=>g.value=!0),style:{height:"10px"}},{default:o(()=>[v("注册")]),_:1})])]),de,l("div",{class:"gvb_login_other_icons"},[l("img",{src:Y,onClick:F,class:"gvb_login_other_icon",alt:""})])])])])}}};export{ce as default};
