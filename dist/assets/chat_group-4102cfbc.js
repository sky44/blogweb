import{S as A,r as D,c as E,x as I,d as h,o as c,e as i,f as _,g as e,y as b,F as J,k as L,w as r,j as p,v as O,m as v,t as u,l as x,p as $,h as H,z as G}from"./index-60e5bf44.js";import{_ as W}from"./gvb_footer.vue_vue_type_style_index_0_lang-29b6c941.js";/* empty css                                                   */import{a as C}from"./date-d051bfca.js";import"./gvb_user_info-c13ee589.js";import"./logout-12528159.js";import"./user_api-595c9794.js";import"./article_api-61275ba2.js";function j(f){return A.get("/api/chat_groups_records",{params:f})}const q={class:"base_view chat_group_view"},P={class:"gvb_chat_inner_container"},Q=e("div",{class:"gvb_chat_head"},[e("div",{class:"title"},"ã€ç«â˜…ç†±â˜…å‹â˜…æ…¡ğŸ”ã€‘åœ¨çº¿èŠå¤©å®¤"),e("div",{class:"people_num"},"åœ¨çº¿äººæ•°ï¼š 25273ğŸ”¥")],-1),X={key:0,class:"in_room_msg"},Y={key:1,class:"out_room_msg"},Z={class:"avatar"},ee=["src"],te={class:"message-main"},se={class:"message-user"},oe={class:"message-content"},ae={class:"content"},ne={class:"txt-message"},le=e("i",{class:"fa fa-cloud-upload"},null,-1),ce=[le],ie=e("i",{class:"fa fa-file-image-o"},null,-1),_e=[ie],re=e("i",{class:"fa fa-file-audio-o"},null,-1),ue=[re],de={class:"gvb_chat_footer"},me={key:0,class:"gvb_chat_mask"},be={__name:"chat_group",setup(f){let l=null,g=0;const B=1,y=2,S=7,d=D(null),t=E({allHeight:"100vh",setHeight:"597px",message_list:[],user_info:{nick_name:"",avatar:""},content:"",online:1,mask:!0});async function T(){let s=document.documentElement.scrollHeight;t.allHeigh=s+"px";let o=s-340;t.setHeight=o+"px";let n=await j({limit:50});t.message_list=n.data.list,t.message_list.reverse()}function M(){let s=`ws://${location.host}/wsUrl`;l=new WebSocket(s+"/api/chat_groups"),l.onmessage=N,l.onopen=function(o){console.log("onopen: ",o),t.mask=!1,setTimeout(w,100)},l.onerror=function(o){console.log("onerror: ",o)},l.onclose=function(o){console.log("onclose: ",o)}}function N(s){let o=s.data,n=JSON.parse(o);if(g===0){t.user_info.nick_name=n.nick_name,g++;return}U(n),g++}function U(s){s.nick_name===t.user_info.nick_name&&(s.is_me=!0),t.message_list.push(s)}function k(){let s={content:t.content,msg_type:y};l.send(JSON.stringify(s)),t.content="",setTimeout(w,100)}function w(){let s=d.value.scrollHeight,o=d.value.clientHeight,n=null;n=setInterval(()=>{let m=d.value.scrollTop;if(s<=m+o){clearInterval(n);return}d.value.scrollTop+=20},5)}I(()=>{l!==null&&l.close()}),T();function R(){v.warn("æš‚æœªå¼€å‘å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½")}function z(){v.warn("æš‚æœªå¼€å‘è¯­éŸ³ä¸Šä¼ åŠŸèƒ½")}function V(){v.warn("æš‚æœªå¼€å‘æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½")}return(s,o)=>{const n=h("a-tooltip"),m=h("a-button"),F=h("a-textarea");return c(),i("div",q,[_(W,{is_show:""}),e("div",{class:"gvb_chat_base_container",style:b({height:t.allHeight})},[e("div",P,[Q,e("div",{class:"gvb_chat_body",ref_key:"chatBody",ref:d,style:b({height:t.setHeight})},[(c(!0),i(J,null,L(t.message_list,(a,K)=>(c(),i("div",{class:"message",key:K},[a.msg_type===B?(c(),i("div",X,[_(n,{placement:"top"},{title:r(()=>[e("span",null,u(x(C)(a.created_at)),1)]),default:r(()=>[e("span",null,u(a.content),1)]),_:2},1024)])):p("",!0),a.msg_type===S?(c(),i("div",Y,[_(n,{placement:"top"},{title:r(()=>[e("span",null,u(x(C)(a.created_at)),1)]),default:r(()=>[e("span",null,u(a.content),1)]),_:2},1024)])):p("",!0),a.msg_type===y?(c(),i("div",{key:2,class:$({me:a.is_me})},[e("div",Z,[e("img",{src:a.avatar,alt:""},null,8,ee)]),e("div",te,[e("div",se,u(a.nick_name),1),e("div",oe,[e("div",ae,[e("div",ne,u(a.content),1)])])])],2)):p("",!0)]))),128))],4),e("div",{class:"gvb_chat_menu"},[e("span",{onClick:V},ce),e("span",{onClick:R},_e),e("span",{onClick:z},ue)]),e("div",de,[t.mask?(c(),i("div",me,[_(m,{type:"primary",class:"connect_chat_btn",onClick:M},{default:r(()=>[H("è¿›å…¥èŠå¤©å®¤")]),_:1})])):p("",!0),_(F,{value:t.content,"onUpdate:value":o[0]||(o[0]=a=>t.content=a),placeholder:"ä»Šæ—¥ï¼Œæˆ‘ä»¬ç›¸çº¦åœ¨æ­¤ï¼Œæ•å¼€ä½ çš„å¿ƒæ‰‰ï¼Œé‡Šæ”¾ä½ çš„æ¿€æƒ…!",onKeydown:O(G(k,["ctrl"]),["enter"]),"auto-size":{minRows:4,maxRows:4}},null,8,["value","onKeydown"]),_(m,{onClick:k,class:"chat_btn"},{default:r(()=>[H("å‘é€")]),_:1})])])],4)])}}};export{be as default};
